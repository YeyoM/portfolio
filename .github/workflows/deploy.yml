  name: Deploy
  on:
    push:
      branches:
        - main
    workflow_dispatch:

  jobs:
    deploy:
      name: "Deploy to VPS"
      runs-on: ubuntu-latest
      steps:
        - name: Deploy
          uses: appleboy/ssh-action@master
          with:
            host: ${{ secrets.SSH_IP }}
            username: ${{ secrets.SSH_USER }}
            key: ${{ secrets.SSH_PRIVATE_KEY }}
            script: |
              ~/redeploy.sh

        - name: Discord Message
          run: curl -s -X POST "${{ secrets.DISCORD_WEBHOOK }}" -d "content=üöÄ Deployment Successful"
      
    notify_failure:
      name: "Notify Failure"
      runs-on: ubuntu-latest
      needs: deploy
      if: ${{ always() && contains(needs.*.result, 'failure') }}
      steps:
        - name: Discord Message
          run: curl -s -X POST "${{ secrets.DISCORD_WEBHOOK }}" -d "content=‚ùå Deployment Failed"